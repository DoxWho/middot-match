<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Middot Match Master</title>
<style>
  :root {
    --primary: #2980b9; --secondary: #34495e; --success: #27ae60;
    --bonus: #f1c40f; --danger: #e74c3c; --warning: #e67e22; --bg: #f4f6f8;
  }

  body { font-family: 'Segoe UI', Tahoma, sans-serif; text-align: center; background: var(--bg); margin: 0; padding: 10px; overflow-x: hidden; }
  .hidden { display: none !important; }

  /* TOOLTIPS & SETTINGS */
  .info-icon { background: var(--secondary); color: white; border-radius: 50%; width: 20px; height: 20px; display: inline-flex; justify-content: center; align-items: center; cursor: help; font-size: 12px; margin-left: 5px; }
  .tooltip-box { position: relative; display: inline-block; }
  .tooltip-box:hover::after { 
    content: attr(data-tip); position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); 
    background: var(--secondary); color: white; padding: 10px; border-radius: 8px; font-size: 12px; width: 180px; z-index: 100; font-weight: normal; line-height: 1.3;
  }

  .settings-bar { background: #fff; padding: 10px; border-radius: 12px; margin: 10px auto; border: 1px solid #ddd; width: 95%; max-width: 550px; display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; font-size: 13px; font-weight: bold; }

  /* THREE-DECK SYSTEM */
  .deck-area { display: flex; justify-content: center; gap: 20px; margin: 20px 0; perspective: 1000px; }
  .deck { width: 80px; height: 110px; border-radius: 8px; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; font-weight: 900; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: transform 0.3s; }
  .deck-label { font-size: 10px; text-transform: uppercase; margin-top: 5px; color: var(--secondary); position: absolute; bottom: -20px; width: 100%; }
  
  .deck-main { background: var(--primary); border: 3px solid #fff; }
  .deck-success { background: var(--success); border: 3px solid #fff; }
  .deck-sc { background: var(--warning); border: 3px solid #fff; }
  
  .deck-count { font-size: 28px; }

  /* ANIMATIONS */
  @keyframes flipIn {
    0% { transform: scale(1.5) rotateY(90deg); opacity: 0; }
    100% { transform: scale(1) rotateY(0deg); opacity: 1; }
  }
  .animate-count { animation: flipIn 0.4s ease-out; }

  /* SCOREBOARD */
  .scoreboard { display: flex; justify-content: center; gap: 15px; margin: 25px 0; flex-wrap: wrap; }
  .team-pod { background: white; padding: 15px; border-radius: 15px; border: 5px solid #ccc; min-width: 250px; position: relative; }
  .team-name-input { font-family: 'Arial Black', sans-serif; font-size: 24px; text-transform: uppercase; border: none; background: transparent; text-align: center; width: 85%; border-bottom: 2px dashed #eee; outline: none; }
  .score-number { display: block; font-size: 65px; font-weight: bold; color: var(--secondary); }

  /* CARD UI */
  .card { background: white; border-radius: 20px; padding: 25px; width: 90%; max-width: 500px; margin: 10px auto; box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 1px solid #ddd; border-top: 15px solid var(--primary); position: relative; }
  .active-team-banner { font-family: 'Arial Black', sans-serif; font-size: 20px; text-transform: uppercase; margin-bottom: 10px; }
  .timer { font-size: 55px; font-weight: bold; margin: 15px 0; color: var(--warning); }
  .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  
  button { cursor: pointer; font-weight: bold; border-radius: 12px; border: none; }
  .btn-start { color: white; width: 180px; margin: 10px; padding: 14px; border: 4px solid transparent; text-transform: uppercase; }
  .sc-mode-btn { border-color: var(--warning) !important; }
  .btn-util { background: #95a5a6; color: white; font-size: 12px; padding: 8px 15px; margin: 5px; }

  .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.92); z-index: 1000; display: flex; justify-content: center; align-items: center; color: white; flex-direction: column; }
</style>
</head>
<body onload="loadGame()">

<div id="home">
  <h1>Middot Match 
    <span class="info-icon tooltip-box" data-tip="Describe the term without using forbidden words. 1pt for English, 2pts for Hebrew name. Team with most points wins!">i</span>
  </h1>

  <div class="settings-bar">
    <div>
        Round Time: <input type="range" id="timeSlider" min="15" max="120" step="5" value="30" oninput="updateTimeLabel(this.value)"> 
        <span id="timeLabel">30s</span>
    </div>
    <div class="tooltip-box" data-tip="Shows a 3-second 'Ready?' countdown before each card.">
        Countdown: <input type="checkbox" id="checkCountdown" checked onchange="saveGame()">
    </div>
  </div>

  <div class="deck-area">
    <div class="deck deck-success">
        <span id="countMastered" class="deck-count">0</span>
        <span class="deck-label">Mastered</span>
    </div>
    <div class="deck deck-main">
        <span id="countRemaining" class="deck-count">0</span>
        <span class="deck-label">Main Deck</span>
    </div>
    <div class="deck deck-sc">
        <span id="countSecond" class="deck-count">0</span>
        <span class="deck-label">2nd Chance</span>
    </div>
  </div>

  <div class="scoreboard">
    <div class="team-pod" id="podA">
      <label style="position:absolute; top:10px; right:10px; cursor:pointer">üé®<input type="color" class="hidden" oninput="updateTeamColor('A', this.value)" onchange="saveGame()"></label>
      <input type="text" id="nameA" class="team-name-input" value="TEAM A" oninput="syncNames()">
      <span id="scoreA" class="score-number">0</span>
    </div>
    <div class="team-pod" id="podB">
      <label style="position:absolute; top:10px; right:10px; cursor:pointer">üé®<input type="color" class="hidden" oninput="updateTeamColor('B', this.value)" onchange="saveGame()"></label>
      <input type="text" id="nameB" class="team-name-input" value="TEAM B" oninput="syncNames()">
      <span id="scoreB" class="score-number">0</span>
    </div>
  </div>

  <div>
    <button class="btn-start" id="btnA" onclick="initRound('A')">Start</button>
    <button class="btn-start" id="btnB" onclick="initRound('B')">Start</button>
  </div>

  <button class="btn-util" style="margin-top:20px" onclick="confirmReset()">End Game & Reset</button>
</div>

<div id="roundView" class="hidden">
  <div id="gameCard" class="card">
    <button style="position:absolute; top:15px; left:15px; background:none; font-size:30px; color:#ccc" onclick="undoSelect()">‚Üê</button>
    <div id="activeTeamBanner" class="active-team-banner"></div>
    <div id="scCardBadge" class="hidden" style="background:var(--warning); color:white; padding:4px 10px; border-radius:5px; font-size:12px; margin-bottom:10px; display:inline-block">SECOND CHANCE</div>
    <h2 id="middahName" style="font-size:44px; margin:5px 0"></h2>
    <h3 id="middahHebrew" style="font-size:28px; color:#7f8c8d; margin-bottom:15px"></h3>
    <div style="color:var(--danger); border-top:2px dashed #eee; padding-top:15px">
        <p id="forbiddenWords" style="font-weight:bold; font-size:20px"></p>
    </div>
    <div class="timer" id="timerDisp">30</div>
    <div id="gameActions" class="btn-grid">
      <button style="background:var(--success); color:white; padding:15px" onclick="recordScore(1)">Correct (1pt)</button>
      <button style="background:var(--bonus); padding:15px" onclick="recordScore(2)">Bonus (2pts)</button>
      <button style="background:var(--danger); color:white; padding:15px; grid-column:span 2" onclick="recordMiss()">Skip Card</button>
    </div>
  </div>
</div>

<div id="countOverlay" class="overlay hidden"><div style="font-size:120px; font-weight:bold" id="cdNumber">3</div></div>

<div id="winOverlay" class="overlay hidden">
  <div style="background:white; color:#333; padding:40px; border-radius:20px; width:80%">
    <div style="font-size:70px">üèÜ</div>
    <h2 id="winnerText" style="font-size:32px"></h2>
    <button style="background:var(--success); color:white; padding:15px; margin:10px" onclick="playAgain(true)">Same Teams</button>
    <button style="background:var(--danger); color:white; padding:15px; margin:10px" onclick="playAgain(false)">New Class</button>
  </div>
</div>

<script>
let scoreA = 0, scoreB = 0, currentTeam = "", timeLeft = 30, timerInterval;
let missedCards = [], usedCards = [], currentCard = null, pendingCard = null, isSC = false;
let colorA = "#2980b9", colorB = "#8e44ad";

const cardData = [
  { eng: "Wisdom", heb: "◊ó÷∏◊õ÷∞◊û÷∏◊î", taboo: ["wise", "smart", "brain", "know", "learn"], color: "#234a8e" },
  { eng: "Understanding", heb: "◊ë÷º÷¥◊ô◊†÷∏◊î", taboo: ["reason", "logic", "think", "why", "explain"], color: "#234a8e" },
  { eng: "Sensibility", heb: "◊ì÷º÷∑◊¢÷∑◊™", taboo: ["aware", "sense", "mind", "logic", "fact"], color: "#234a8e" },
  { eng: "Curiosity", heb: "◊°÷∑◊ß÷∞◊®÷∏◊†◊ï÷º◊™", taboo: ["wonder", "ask", "question", "interest", "new"], color: "#234a8e" },
  { eng: "Creativity", heb: "◊ô÷∞◊¶÷¥◊ô◊®÷∏◊™÷¥◊ô÷º◊ï÷º◊™", taboo: ["make", "art", "imagine", "build", "new"], color: "#234a8e" },
  { eng: "Courage", heb: "◊ê◊ï÷π◊û÷∂◊• ◊ú÷µ◊ë", taboo: ["brave", "fear", "hero", "scared", "bold"], color: "#48c0e9" },
  { eng: "Zest & Zeal", heb: "◊ñ÷∞◊®÷¥◊ô◊ñ◊ï÷º◊™", taboo: ["fast", "quick", "energy", "rush", "eager"], color: "#48c0e9" },
  { eng: "Confidence", heb: "◊ë÷º÷¥◊ò÷º÷∏◊ó◊ï÷π◊ü", taboo: ["trust", "sure", "believe", "secure", "safe"], color: "#48c0e9" },
  { eng: "Discipline", heb: "◊í÷º÷∞◊ë◊ï÷º◊®÷∏◊î", taboo: ["strength", "control", "power", "rule", "strong"], color: "#48c0e9" },
  { eng: "Perseverance", heb: "◊†÷∂◊¶÷∑◊ó", taboo: ["never quit", "persist", "win", "goal", "keep going"], color: "#48c0e9" },
  { eng: "Decency", heb: "◊ì÷º÷∂◊®÷∂◊ö÷∞ ◊ê÷∂◊®÷∂◊•", taboo: ["respect", "manners", "polite", "nice", "behavior"], color: "#f5a623" },
  { eng: "Compassion", heb: "◊®÷∑◊ó÷≤◊û÷¥◊ô◊ù", taboo: ["pity", "care", "empathy", "feel", "soft"], color: "#f5a623" },
  { eng: "Kindness", heb: "◊ó÷∂◊°÷∂◊ì", taboo: ["help", "give", "charity", "nice", "love"], color: "#f5a623" },
  { eng: "Leadership", heb: "◊û÷∑◊†÷∞◊î÷¥◊ô◊í◊ï÷º◊™", taboo: ["king", "rule", "boss", "lead", "guide"], color: "#f5a623" },
  { eng: "Justice", heb: "◊¶÷∂◊ì÷∂◊ß", taboo: ["fair", "law", "court", "right", "judge"], color: "#d00256" },
  { eng: "Responsibility", heb: "◊ê÷∑◊ó÷∞◊®÷∏◊ô◊ï÷º◊™", taboo: ["duty", "blame", "job", "task", "care"], color: "#d00256" },
  { eng: "Pursuit of Peace", heb: "◊®◊ï÷π◊ì÷µ◊£ ◊©◊Å÷∏◊ú◊ï÷π◊ù", taboo: ["quiet", "fight", "calm", "war", "stop"], color: "#d00256" },
  { eng: "Calm & Composure", heb: "◊û÷∞◊†◊ï÷º◊ó÷∑◊™ ◊î÷∑◊†÷º÷∂◊§÷∂◊©◊Å", taboo: ["quiet", "rest", "peace", "still", "relax"], color: "#65ba45" },
  { eng: "Humility", heb: "◊¢÷≤◊†÷∏◊ï÷∏◊î", taboo: ["modest", "proud", "ego", "boast", "simple"], color: "#65ba45" },
  { eng: "Patience", heb: "◊°÷∑◊ë÷∞◊ú÷∏◊†◊ï÷º◊™", taboo: ["wait", "slow", "time", "annoy", "calm"], color: "#65ba45" },
  { eng: "Forgiveness", heb: "◊û÷∞◊ó÷¥◊ô◊ú÷∏◊î", taboo: ["sorry", "pardon", "forget", "mercy", "anger"], color: "#65ba45" },
  { eng: "Contentment", heb: "◊î÷¥◊°÷∞◊™÷º÷∑◊§÷º÷∞◊ß◊ï÷º◊™", taboo: ["happy", "enough", "satisfied", "want", "more"], color: "#65ba45" },
  { eng: "Love", heb: "◊ê÷∑◊î÷≤◊ë÷∏◊î", taboo: ["heart", "like", "care", "friend", "hug"], color: "#9013fe" },
  { eng: "Gratitude", heb: "◊î÷∑◊õ÷º÷∏◊®÷∑◊™ ◊î÷∑◊ò÷º◊ï÷π◊ë", taboo: ["thanks", "grateful", "blessing", "appreciate", "good"], color: "#9013fe" },
  { eng: "Joy", heb: "◊©◊Ç÷¥◊û÷∞◊ó÷∏◊î", taboo: ["happy", "smile", "fun", "laugh", "celebrate"], color: "#9013fe" },
  { eng: "Foundation", heb: "◊ô÷∞◊°◊ï÷π◊ì", taboo: ["base", "ground", "root", "start", "bottom"], color: "#9013fe" }
];

function updateTimeLabel(v) { document.getElementById('timeLabel').innerText = v + 's'; saveGame(); }

function saveGame() {
  const state = { scoreA, scoreB, nameA: document.getElementById('nameA').value, nameB: document.getElementById('nameB').value, used: usedCards.map(c => c.eng), missed: missedCards.map(c => c.eng), isSC, colorA, colorB, time: document.getElementById('timeSlider').value, countOn: document.getElementById('checkCountdown').checked };
  localStorage.setItem('middot_v6_audit', JSON.stringify(state));
}

function loadGame() {
  const s = JSON.parse(localStorage.getItem('middot_v6_audit'));
  if(!s) { updateTeamColor('A', colorA); updateTeamColor('B', colorB); updateDecks(); return syncNames(); }
  scoreA = s.scoreA; scoreB = s.scoreB;
  document.getElementById('nameA').value = s.nameA; document.getElementById('nameB').value = s.nameB;
  usedCards = cardData.filter(c => s.used.includes(c.eng));
  missedCards = cardData.filter(c => s.missed.includes(c.eng));
  isSC = s.isSC;
  document.getElementById('timeSlider').value = s.time || 30;
  document.getElementById('timeLabel').innerText = (s.time || 30) + 's';
  document.getElementById('checkCountdown').checked = s.countOn !== false;
  updateTeamColor('A', s.colorA || colorA); updateTeamColor('B', s.colorB || colorB);
  syncNames(); updateDisp(); updateDecks(false);
}

function updateDecks(animate = true) {
    const mainRem = cardData.filter(c => !usedCards.includes(c)).length;
    const mastered = usedCards.length - missedCards.length;
    const scCount = missedCards.length;

    updateCounter('countRemaining', mainRem, animate);
    updateCounter('countMastered', mastered, animate);
    updateCounter('countSecond', scCount, animate);

    if(mainRem === 0 && scCount > 0) {
        isSC = true;
        document.getElementById("btnA").classList.add("sc-mode-btn");
        document.getElementById("btnB").classList.add("sc-mode-btn");
    }
}

function updateCounter(id, val, anim) {
    const el = document.getElementById(id);
    if(anim && el.innerText != val) { el.classList.remove('animate-count'); void el.offsetWidth; el.classList.add('animate-count'); }
    el.innerText = val;
}

function updateTeamColor(t, hex) {
  if(t === 'A') { colorA = hex; document.getElementById('podA').style.borderColor = hex; document.getElementById('btnA').style.background = hex; }
  else { colorB = hex; document.getElementById('podB').style.borderColor = hex; document.getElementById('btnB').style.background = hex; }
}

function syncNames() {
  document.getElementById("btnA").innerText = "Start " + document.getElementById("nameA").value;
  document.getElementById("btnB").innerText = "Start " + document.getElementById("nameB").value;
  saveGame();
}

function initRound(team) {
  currentTeam = team;
  document.getElementById("home").classList.add("hidden");
  if(!document.getElementById("checkCountdown").checked) return runGame();
  document.getElementById("countOverlay").classList.remove("hidden");
  let c = 3; document.getElementById("cdNumber").innerText = c;
  let cd = setInterval(() => {
    c--; if(c === 0) { clearInterval(cd); document.getElementById("countOverlay").classList.add("hidden"); runGame(); }
    else document.getElementById("cdNumber").innerText = c;
  }, 1000);
}

function runGame() {
  document.getElementById("roundView").classList.remove("hidden");
  document.getElementById("gameActions").classList.remove("hidden");
  document.getElementById("scCardBadge").classList.toggle("hidden", !isSC);
  document.getElementById("activeTeamBanner").innerText = document.getElementById("name" + currentTeam).value;
  document.getElementById("activeTeamBanner").style.color = (currentTeam === "A" ? colorA : colorB);

  if(pendingCard) { currentCard = pendingCard; pendingCard = null; } 
  else {
    let pool = isSC ? missedCards : cardData.filter(c => !usedCards.includes(c));
    if(pool.length === 0) { goHome(); return; }
    currentCard = pool[Math.floor(Math.random() * pool.length)];
    if(!isSC) usedCards.push(currentCard);
  }
  document.getElementById("gameCard").style.borderTopColor = currentCard.color;
  document.getElementById("middahName").innerText = currentCard.eng;
  document.getElementById("middahHebrew").innerText = currentCard.heb;
  document.getElementById("forbiddenWords").innerText = currentCard.taboo.join(" ‚Ä¢ ");
  timeLeft = parseInt(document.getElementById("timeSlider").value);
  document.getElementById("timerDisp").innerText = timeLeft;
  timerInterval = setInterval(() => {
    timeLeft--; document.getElementById("timerDisp").innerText = timeLeft;
    if(timeLeft <= 0) { clearInterval(timerInterval); document.getElementById("timerDisp").innerText = "TIME!"; }
  }, 1000);
}

function recordScore(pts) {
  clearInterval(timerInterval);
  if(currentTeam === "A") scoreA += pts; else scoreB += pts;
  if(isSC) missedCards = missedCards.filter(c => c !== currentCard);
  updateDisp(); 
  document.getElementById("timerDisp").innerText = "‚úî SUCCESS";
  setTimeout(goHome, 1000);
}

function recordMiss() {
  clearInterval(timerInterval);
  if(!missedCards.includes(currentCard)) missedCards.push(currentCard);
  document.getElementById("timerDisp").innerText = "SKIPPED";
  setTimeout(goHome, 1000);
}

function confirmReset() {
    let a = document.getElementById("nameA").value, b = document.getElementById("nameB").value;
    document.getElementById("winnerText").innerText = scoreA > scoreB ? a+" WINS!" : (scoreB > scoreA ? b+" WINS!" : "IT'S A TIE!");
    document.getElementById("winOverlay").classList.remove("hidden");
}

function playAgain(keepTeams) {
    if(!keepTeams) { localStorage.clear(); location.reload(); }
    else {
        scoreA = 0; scoreB = 0; usedCards = []; missedCards = []; isSC = false;
        document.getElementById("winOverlay").classList.add("hidden");
        document.getElementById("btnA").classList.remove("sc-mode-btn");
        document.getElementById("btnB").classList.remove("sc-mode-btn");
        updateDisp(); updateDecks(false); saveGame();
    }
}

function undoSelect() { clearInterval(timerInterval); pendingCard = currentCard; goHome(); }
function goHome() { document.getElementById("roundView").classList.add("hidden"); document.getElementById("home").classList.remove("hidden"); updateDecks(true); saveGame(); }
function updateDisp() { document.getElementById("scoreA").innerText = scoreA; document.getElementById("scoreB").innerText = scoreB; }
</script>
</body>
</html>